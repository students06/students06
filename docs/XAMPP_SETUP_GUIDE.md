# دليل تشغيل نظام إدارة الحضور على XAMPP

## 📋 المتطلبات الأساسية

### 1. تثبيت البرامج المطلوبة:
- **XAMPP** (أحدث إصدار)
- **Node.js** (الإصدار 16 أو أحدث)
- **Git** (اختياري)

### 2. تحميل المشروع:
```bash
# إذا كان لديك Git
git clone [repository-url]

# أو قم بتحميل الملفات وفك الضغط
```

## 🚀 خطوات التثبيت والإعداد

### الخطوة 1: إعداد XAMPP

1. **تشغيل XAMPP Control Panel**
2. **تشغيل الخدمات المطلوبة:**
   - ✅ Apache
   - ✅ MySQL
3. **التأكد من تشغيل الخدمات** (يجب أن تظهر باللون الأخضر)

### الخطوة 2: إنشاء قاعدة البيانات

1. **فتح phpMyAdmin:**
   - اذهب إلى: `http://localhost/phpmyadmin`
   - أو اضغط على "Admin" بجانب MySQL في XAMPP

2. **إنشاء قاعدة البيانات:**
   - اضغط على "New" في الشريط الجانبي
   - اكتب اسم قاعدة البيانات: `attendance_system`
   - اختر Collation: `utf8mb4_unicode_ci`
   - اضغط "Create"

3. **استيراد هيكل قاعدة البيانات:**
   - اختر قاعدة البيانات `attendance_system`
   - اضغط على تبويب "Import"
   - اضغط "Choose File" واختر ملف `database/attendance_system.sql`
   - اضغط "Go"
   - انتظر حتى تظهر رسالة النجاح

### الخطوة 3: إعداد ملف البيئة

1. **إنشاء ملف `.env`:**
   ```bash
   # في مجلد المشروع الرئيسي
   cp .env.example .env
   ```

2. **تعديل إعدادات قاعدة البيانات في `.env`:**
   ```env
   # إعدادات قاعدة البيانات
   DB_HOST=localhost
   DB_USER=root
   DB_PASSWORD=
   DB_NAME=attendance_system
   
   # إعدادات الخادم
   PORT=3001
   NODE_ENV=development
   ```

### الخطوة 4: تثبيت المكتبات

1. **فتح Terminal/Command Prompt في مجلد المشروع**

2. **تثبيت مكتبات Node.js:**
   ```bash
   npm install
   ```

3. **انتظار انتهاء التثبيت** (قد يستغرق بضع دقائق)

### الخطوة 5: بناء المشروع

```bash
# بناء ملفات الواجهة الأمامية
npm run build
```

### الخطوة 6: تشغيل النظام

#### الطريقة الأولى - تشغيل كامل:
```bash
npm run dev:full
```

#### الطريقة الثانية - تشغيل منفصل:
```bash
# Terminal 1 - الواجهة الأمامية
npm run dev

# Terminal 2 - الخادم الخلفي
npm run dev:server
```

#### الطريقة الثالثة - الإنتاج:
```bash
npm start
```

## 🌐 الوصول للنظام

### عناوين الوصول:
- **النظام الكامل:** `http://localhost:3001`
- **API فقط:** `http://localhost:3001/api`
- **phpMyAdmin:** `http://localhost/phpmyadmin`

### بيانات الدخول الافتراضية:

#### المدير العام:
- **اسم المستخدم:** `admin`
- **كلمة المرور:** `admin123`

#### المشرف الأول:
- **اسم المستخدم:** `supervisor1`
- **كلمة المرور:** `super123`

#### المشرف الثاني:
- **اسم المستخدم:** `supervisor2`
- **كلمة المرور:** `super123`

## 🔧 إعداد الواتساب

### المتطلبات:
- **Google Chrome** مثبت على النظام
- **اتصال إنترنت مستقر**
- **هاتف ذكي** مع واتساب

### خطوات التهيئة:

1. **تسجيل الدخول للنظام**
2. **الذهاب إلى "إدارة الواتساب"**
3. **الضغط على "تهيئة الواتساب"**
4. **انتظار ظهور QR Code في وحدة التحكم (Console)**
5. **فتح واتساب على الهاتف:**
   - الإعدادات → الأجهزة المرتبطة → ربط جهاز
6. **مسح QR Code**
7. **انتظار رسالة التأكيد**

## 📊 اختبار النظام

### 1. اختبار قاعدة البيانات:
- تسجيل الدخول بنجاح
- عرض قوائم الطلاب والفصول
- إضافة طالب جديد

### 2. اختبار الحضور:
- إنشاء جلسة جديدة
- تسجيل حضور طالب
- عرض التقارير

### 3. اختبار الواتساب:
- تهيئة الواتساب
- إرسال رسالة تجريبية
- فحص سجل الرسائل

## 🛠️ استكشاف الأخطاء وحلها

### مشكلة: خطأ في الاتصال بقاعدة البيانات

**الأعراض:**
```
❌ خطأ في الاتصال بقاعدة البيانات: Access denied for user 'root'@'localhost'
```

**الحلول:**
1. **تأكد من تشغيل MySQL في XAMPP**
2. **تحقق من إعدادات `.env`:**
   ```env
   DB_HOST=localhost
   DB_USER=root
   DB_PASSWORD=
   ```
3. **إعادة تشغيل MySQL من XAMPP**

### مشكلة: المنفذ مستخدم

**الأعراض:**
```
Error: listen EADDRINUSE: address already in use :::3001
```

**الحلول:**
1. **تغيير المنفذ في `.env`:**
   ```env
   PORT=3002
   ```
2. **أو إيقاف العملية المستخدمة للمنفذ:**
   ```bash
   # Windows
   netstat -ano | findstr :3001
   taskkill /PID [PID_NUMBER] /F
   
   # Linux/Mac
   lsof -ti:3001 | xargs kill -9
   ```

### مشكلة: ملفات مفقودة

**الأعراض:**
```
Cannot find module 'express'
```

**الحل:**
```bash
# حذف مجلد node_modules وإعادة التثبيت
rm -rf node_modules package-lock.json
npm install
```

### مشكلة: خطأ في بناء المشروع

**الحل:**
```bash
# تنظيف وإعادة البناء
npm run build
```

### مشكلة: الواتساب لا يتصل

**الأعراض:**
- QR Code لا يظهر
- رسالة خطأ في التهيئة

**الحلول:**
1. **تأكد من تثبيت Chrome:**
   ```bash
   # Windows - تحميل من الموقع الرسمي
   # Linux
   sudo apt install google-chrome-stable
   ```

2. **تنظيف ملفات التوكن:**
   ```bash
   rm -rf tokens/
   mkdir tokens
   ```

3. **إعادة تشغيل الخادم:**
   ```bash
   npm run dev:server
   ```

## 📁 هيكل المشروع

```
attendance-system/
├── database/
│   └── attendance_system.sql      # ملف قاعدة البيانات
├── server/
│   ├── config/
│   │   └── database.js            # إعدادات قاعدة البيانات
│   ├── models/                    # نماذج البيانات
│   ├── routes/                    # مسارات API
│   ├── services/                  # خدمات النظام
│   └── server.js                  # الخادم الرئيسي
├── src/                           # الواجهة الأمامية
├── docs/                          # الوثائق
├── .env                           # إعدادات البيئة
├── package.json                   # إعدادات المشروع
└── README.md                      # دليل المشروع
```

## 🔒 الأمان والصيانة

### نصائح الأمان:
1. **تغيير كلمات المرور الافتراضية**
2. **تفعيل كلمة مرور لـ MySQL في XAMPP**
3. **عدم تشغيل XAMPP على شبكة عامة**
4. **نسخ احتياطي دوري لقاعدة البيانات**

### النسخ الاحتياطي:
```bash
# تصدير قاعدة البيانات
mysqldump -u root -p attendance_system > backup_$(date +%Y%m%d).sql

# استيراد النسخة الاحتياطية
mysql -u root -p attendance_system < backup_20240115.sql
```

## 📞 الدعم الفني

### في حالة مواجهة مشاكل:

1. **تحقق من سجلات الأخطاء:**
   - وحدة التحكم في المتصفح (F12)
   - Terminal حيث يعمل الخادم

2. **إعادة تشغيل الخدمات:**
   ```bash
   # إعادة تشغيل XAMPP
   # إعادة تشغيل الخادم
   npm run dev:server
   ```

3. **التحقق من الاتصالات:**
   - قاعدة البيانات: `http://localhost/phpmyadmin`
   - API: `http://localhost:3001/api/dashboard/stats`

4. **مراجعة الإعدادات:**
   - ملف `.env`
   - إعدادات XAMPP

---

## ✅ قائمة التحقق النهائية

- [ ] XAMPP مثبت ويعمل
- [ ] MySQL و Apache يعملان
- [ ] قاعدة البيانات تم إنشاؤها واستيرادها
- [ ] Node.js مثبت
- [ ] المكتبات تم تثبيتها (`npm install`)
- [ ] ملف `.env` تم إنشاؤه وتعديله
- [ ] المشروع تم بناؤه (`npm run build`)
- [ ] الخادم يعمل (`npm start`)
- [ ] يمكن الوصول للنظام على `http://localhost:3001`
- [ ] تسجيل الدخول يعمل
- [ ] الواتساب تم تهيئته (اختياري)

**🎉 تهانينا! النظام جاهز للاستخدام**